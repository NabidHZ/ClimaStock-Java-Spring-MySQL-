<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Recomendaciones por Tienda</title>
  <link rel="stylesheet" href="/css/stylesheet.css">
</head>
<body>
<fragment th:replace="fragments/header :: main-header('Recomendaciones', 'recomendaciones')"/>

<div class="form-container">
  <form th:action="@{/recomendaciones}" method="get" class="filter-form" id="filtroRecomendaciones">
    <label for="tienda">Selecciona una tienda:</label>
    <select name="tiendaId" id="tienda" required>
      <option value="">-- Elige una tienda --</option>
      <option th:each="tienda : ${tiendas}"
              th:value="${tienda.id}"
              th:text="${tienda.nombre}"
              th:selected="${tienda.id} == ${selectedTiendaId}">
      </option>
    </select>
    <label for="genero">Género:</label>
    <select name="genero" id="genero" onchange="document.getElementById('filtroRecomendaciones').submit();">
      <option value="">Todos</option>
      <option value="mujer" th:selected="${generoSeleccionado} == 'mujer'">Mujer</option>
      <option value="hombre" th:selected="${generoSeleccionado} == 'hombre'">Hombre</option>
    </select>
    <button type="submit">Ver recomendaciones</button>
  </form>
</div>

<div th:if="${selectedTiendaId != null}">
  <div th:if="${recomendacionesPorDia}">
    <div th:each="dia : ${recomendacionesPorDia}">
      <h2 th:text="'Recomendaciones para ' + ${#temporals.format(dia.fecha, 'dd/MM/yyyy')}"></h2>
      <section class="weather-info">
        <p><strong>Temp. máx prevista:</strong>
          <span th:text="${dia.temperatura} + ' °C'"></span>
        </p>
        <p><strong>¿Previsión de lluvia?:</strong>
          <span th:text="${dia.lluvia} ? 'Sí' : 'No'"></span>
        </p>
      </section>

      <div th:if="${dia.lluvia}" class="alert-message">
        <strong>¡Atención!</strong> Hay previsión de lluvia. Destaca prendas impermeables.
      </div>

      <div th:if="${dia.impermeables != null and #lists.size(dia.impermeables) > 0}">
        <h3>Prendas Impermeables</h3>
        <div class="card-background">
          <div class="card-list">
            <div class="product-card" th:each="producto : ${dia.impermeables}">
              <div class="product-image">
                <img th:if="${producto.imagen}" th:src="@{'/img/' + ${producto.imagen}}" alt="Imagen">
              </div>
              <div class="product-info">
                <h2 th:text="${producto.nombre}"></h2>
                <p><strong>Referencia:</strong> <span th:text="${producto.id}"></span></p>
                <p><strong>Categoría:</strong> <span th:text="${producto.categoria}"></span></p>
                <p><strong>Estación:</strong> <span th:text="${producto.estacion}"></span></p>
                <p><strong>Género:</strong> <span th:text="${producto.genero}"></span></p>
                <p><strong>Sección:</strong> <span th:text="${producto.seccion}"></span></p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div th:if="${dia.productos != null and #lists.size(dia.productos) > 0}">
        <h3>Productos Recomendados</h3>
        <div class="card-background">
          <div class="card-list">
            <div class="product-card" th:each="producto : ${dia.productos}">
              <div class="product-image">
                <img th:if="${producto.imagen}" th:src="@{'/img/' + ${producto.imagen}}" alt="Imagen">
              </div>
              <div class="product-info">
                <h2 th:text="${producto.nombre}"></h2>
                <p><strong>Referencia:</strong> <span th:text="${producto.id}"></span></p>
                <p><strong>Categoría:</strong> <span th:text="${producto.categoria}"></span></p>
                <p><strong>Estación:</strong> <span th:text="${producto.estacion}"></span></p>
                <p><strong>Género:</strong> <span th:text="${producto.genero}"></span></p>
                <p><strong>Sección:</strong> <span th:text="${producto.seccion}"></span></p>
                <p><strong>Impermeable:</strong> <span th:text="${producto.impermeable} ? 'Sí' : 'No'"></span></p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <hr>
    </div>
  </div>
</div>
</body>
</html>